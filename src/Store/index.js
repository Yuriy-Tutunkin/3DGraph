import { reactive } from 'vue'
import * as fs from 'node:fs'



export const state = reactive({
    x: [0],
    y: [0],
    z: [0],
    dataset: {
        "work": 1659224202973,
        "Name": "Месторождение 1",
        "kust": "0",
        "skv": "0",
        "BD": "inclinometr2",
        "TABLE": "H_AUTO_FILE",
        "timeZone": "+5",
        "fieldDescription": {
            "D000": "Дата и время",
            "F001": "Давление циркуляции",
            "F002": "Вес (Нагрузка), kH",
            "F003": "Глубина, м",
            "F004": "Скорость спуска,м/сек",
            "F044": "Azimuth",
            "F045": "Zenith",
            "F046": "rotationPipe",
            "F047": "Temperature",
            "F048": "Pressure",
            "F049": "powerBat",
            "F052": "AzimuthReal",
            "F053": "ZenithReal",
            "F054": "AzimuthKoef",
            "F055": "ZenithKoef",
            "emul": "Режим эмуляции"
        },
        "dataFile": [
            {
                "D000": 1727690563162,
                "F001": "2.00",
                "F002": "9.00",
                "F003": "750.00",
                "F004": "6.00",
                "F044": 261,
                "F045": "2",
                "F046": "200",
                "F047": "30",
                "F048": "0",
                "F049": "34",
                "F052": "261",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727691210260,
                "F001": "2.00",
                "F002": "12.00",
                "F003": "850.10",
                "F004": "6.00",
                "F044": 334,
                "F045": "2",
                "F046": "201",
                "F047": "32",
                "F048": "0",
                "F049": "34",
                "F052": "334",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727691880362,
                "F001": "2.00",
                "F002": "23.00",
                "F003": "950.30",
                "F004": "12.00",
                "F044": 351,
                "F045": "3",
                "F046": "193",
                "F047": "35",
                "F048": "0",
                "F049": "35",
                "F052": "351",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727693195244,
                "F001": "2.00",
                "F002": "25.00",
                "F003": "1050.40",
                "F004": "12.00",
                "F044": 235,
                "F045": "3",
                "F046": "198",
                "F047": "39",
                "F048": "0",
                "F049": "35",
                "F052": "235",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727693836673,
                "F001": "2.00",
                "F002": "28.00",
                "F003": "1150.60",
                "F004": "12.00",
                "F044": 354,
                "F045": "3",
                "F046": "203",
                "F047": "42",
                "F048": "0",
                "F049": "35",
                "F052": "354",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727694475095,
                "F001": "1.00",
                "F002": "31.00",
                "F003": "1250.70",
                "F004": "12.00",
                "F044": 56,
                "F045": "2",
                "F046": "220",
                "F047": "45",
                "F048": "0",
                "F049": "35",
                "F052": "56",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727695120230,
                "F001": "1.00",
                "F002": "32.00",
                "F003": "1350.90",
                "F004": "12.00",
                "F044": 69,
                "F045": "2",
                "F046": "195",
                "F047": "48",
                "F048": "0",
                "F049": "35",
                "F052": "69",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727696657051,
                "F001": "3.00",
                "F002": "43.00",
                "F003": "1451.10",
                "F004": "12.00",
                "F044": 105,
                "F045": "2",
                "F046": "245",
                "F047": "52",
                "F048": "0",
                "F049": "35",
                "F052": "105",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727697581016,
                "F001": "3.00",
                "F002": "40.00",
                "F003": "1551.20",
                "F004": "12.00",
                "F044": 63,
                "F045": "2",
                "F046": "240",
                "F047": "55",
                "F048": "0",
                "F049": "35",
                "F052": "63",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727698220601,
                "F001": "2.00",
                "F002": "38.00",
                "F003": "1651.30",
                "F004": "6.00",
                "F044": 143,
                "F045": "2",
                "F046": "270",
                "F047": "58",
                "F048": "0",
                "F049": "35",
                "F052": "143",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727698868462,
                "F001": "2.00",
                "F002": "46.00",
                "F003": "1751.40",
                "F004": "12.00",
                "F044": 121,
                "F045": "4",
                "F046": "273",
                "F047": "61",
                "F048": "0",
                "F049": "35",
                "F052": "121",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727699564984,
                "F001": "2.00",
                "F002": "49.00",
                "F003": "1851.50",
                "F004": "6.00",
                "F044": 96,
                "F045": "4",
                "F046": "275",
                "F047": "65",
                "F048": "0",
                "F049": "35",
                "F052": "96",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727700224441,
                "F001": "2.00",
                "F002": "57.00",
                "F003": "1951.60",
                "F004": "12.00",
                "F044": 84,
                "F045": "3",
                "F046": "317",
                "F047": "69",
                "F048": "0",
                "F049": "36",
                "F052": "84",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727701685268,
                "F001": "2.00",
                "F002": "56.00",
                "F003": "2051.70",
                "F004": "12.00",
                "F044": 326,
                "F045": "3",
                "F046": "127",
                "F047": "73",
                "F048": "0",
                "F049": "36",
                "F052": "326",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727702327397,
                "F001": "2.00",
                "F002": "65.00",
                "F003": "2151.90",
                "F004": "6.00",
                "F044": 350,
                "F045": "4",
                "F046": "153",
                "F047": "76",
                "F048": "0",
                "F049": "36",
                "F052": "350",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727702966888,
                "F001": "2.00",
                "F002": "67.00",
                "F003": "2252.00",
                "F004": "12.00",
                "F044": 339,
                "F045": "4",
                "F046": "162",
                "F047": "79",
                "F048": "0",
                "F049": "36",
                "F052": "339",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727703639622,
                "F001": "2.00",
                "F002": "72.00",
                "F003": "2352.10",
                "F004": "6.00",
                "F044": 350,
                "F045": "3",
                "F046": "168",
                "F047": "82",
                "F048": "0",
                "F049": "36",
                "F052": "350",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727704298112,
                "F001": "2.00",
                "F002": "74.00",
                "F003": "2452.20",
                "F004": "12.00",
                "F044": 310,
                "F045": "3",
                "F046": "169",
                "F047": "85",
                "F048": "0",
                "F049": "36",
                "F052": "310",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727705344815,
                "F001": "2.00",
                "F002": "73.00",
                "F003": "2552.40",
                "F004": "12.00",
                "F044": 11,
                "F045": "5",
                "F046": "179",
                "F047": "89",
                "F048": "0",
                "F049": "36",
                "F052": "11",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727705989982,
                "F001": "2.00",
                "F002": "77.00",
                "F003": "2652.50",
                "F004": "12.00",
                "F044": 62,
                "F045": "5",
                "F046": "249",
                "F047": "91",
                "F048": "0",
                "F049": "36",
                "F052": "62",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727706629451,
                "F001": "2.00",
                "F002": "74.00",
                "F003": "2752.60",
                "F004": "12.00",
                "F044": 40,
                "F045": "6",
                "F046": "219",
                "F047": "94",
                "F048": "0",
                "F049": "36",
                "F052": "40",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727707275552,
                "F001": "2.00",
                "F002": "86.00",
                "F003": "2852.70",
                "F004": "12.00",
                "F044": 1,
                "F045": "4",
                "F046": "150",
                "F047": "96",
                "F048": "0",
                "F049": "36",
                "F052": "1",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727707916895,
                "F001": "2.00",
                "F002": "87.00",
                "F003": "2952.90",
                "F004": "12.00",
                "F044": 10,
                "F045": "3",
                "F046": "158",
                "F047": "99",
                "F048": "0",
                "F049": "36",
                "F052": "10",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727709351881,
                "F001": "2.00",
                "F002": "95.00",
                "F003": "3054.30",
                "F004": "6.00",
                "F044": 8,
                "F045": "3",
                "F046": "167",
                "F047": "102",
                "F048": "0",
                "F049": "36",
                "F052": "8",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727710013215,
                "F001": "2.00",
                "F002": "92.00",
                "F003": "3154.40",
                "F004": "12.00",
                "F044": 30,
                "F045": "4",
                "F046": "183",
                "F047": "104",
                "F048": "0",
                "F049": "36",
                "F052": "30",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727711010472,
                "F001": "2.00",
                "F002": "96.00",
                "F003": "3254.50",
                "F004": "6.00",
                "F044": 50,
                "F045": "4",
                "F046": "194",
                "F047": "106",
                "F048": "0",
                "F049": "36",
                "F052": "50",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727711691773,
                "F001": "2.00",
                "F002": "102.00",
                "F003": "3354.60",
                "F004": "12.00",
                "F044": 39,
                "F045": "4",
                "F046": "198",
                "F047": "107",
                "F048": "0",
                "F049": "36",
                "F052": "39",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727712326479,
                "F001": "2.00",
                "F002": "102.00",
                "F003": "3454.70",
                "F004": "12.00",
                "F044": 42,
                "F045": "2",
                "F046": "207",
                "F047": "109",
                "F048": "0",
                "F049": "36",
                "F052": "42",
                "F054": "0",
                "emul": 0
            },
            {
                "D000": 1727713579714,
                "F001": "2.00",
                "F002": "107.00",
                "F003": "3554.80",
                "F004": "12.00",
                "F044": 19,
                "F045": "3",
                "F046": "171",
                "F047": "111",
                "F048": "0",
                "F049": "36",
                "F052": "19",
                "F054": "0",
                "emul": 0
            }
        ]
    }
})

function convertToRadians(deg) {
    return Number(deg) * Math.PI/180;
}

function calculationDelta(zenith, azimuth, currentDepth, previousDepth) {
    const thetaRad = convertToRadians(zenith);
    const phiRad = convertToRadians(azimuth);

    const deltaL = currentDepth - previousDepth //если глубина пойдет на уменьшение
    const deltaZ = deltaL * Math.cos(thetaRad);
    const deltaX = deltaL * Math.sin(thetaRad) * Math.sin(phiRad);
    const deltaY = deltaL * Math.sin(thetaRad) * Math.cos(phiRad);

    return [deltaX, deltaY, deltaZ];
}

function calculationAbsoluteCoordinates(arr) {
    return arr.map(el => el[0] + el[1])
}

export function getCoordinates() {
    let previousDepth = 0;
    let Xn = 0;
    let Yn = 0;
    let Zn = 0;
    state.dataset.dataFile.forEach( item => {
        const depth = Number(item['F003']);
        const [dX, dY, dZ] = calculationDelta(item['F045'], item['F044'], depth, previousDepth);
        const [aX, aY, aZ] = calculationAbsoluteCoordinates([[Xn, dX], [Yn, dY], [Zn, dZ]]);
        Xn = aX; state.x.push(aX);
        Yn = aY;state.y.push(aY);
        Zn = aZ; state.z.push(aZ);

        previousDepth = depth;
    })

/*    for (let i =0; i < 5; i ++) {
        const item = state.dataset.dataFile[i];

        const depth = Number(item['F003']) * -1;
        const [dX, dY, dZ] = calculationDelta(item['F045'], item['F044'], depth, previousDepth);
        const [aX, aY, aZ] = calculationAbsoluteCoordinates([[Xn, dX], [Yn, dY], [Zn, dZ]]);
        state.x.push(aX);
        state.y.push(aY);
        state.z.push(aZ);

        previousDepth = depth;
    }*/
}
